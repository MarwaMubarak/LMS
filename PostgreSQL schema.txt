-- Enum type for User roles
CREATE TYPE user_role AS ENUM ('ADMIN', 'PATRON');

-- Users Table
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    email VARCHAR(255) UNIQUE NOT NULL,
    password VARCHAR(255) NOT NULL,
    role user_role NOT NULL
);

-- Staff Table inheriting from Users
CREATE TABLE staffs (
    id INT PRIMARY KEY REFERENCES users(id),
    position VARCHAR(255),
    salary NUMERIC(10, 2)
);

-- Books Table
CREATE TABLE books (
    id SERIAL PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    author VARCHAR(255) NOT NULL,
    isbn VARCHAR(13) UNIQUE NOT NULL,
    copies_available INT DEFAULT 0,
    CONSTRAINT title_author_idx UNIQUE (title, author)
);

-- Indexes for books
CREATE INDEX title_idx ON books (title);
CREATE INDEX author_idx ON books (author);

-- Borrowing History Table
CREATE TABLE borrowing_histories (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    book_id INT NOT NULL REFERENCES books(id) ON DELETE CASCADE,
    borrow_date DATE NOT NULL,
    return_date DATE,
    CONSTRAINT user_book_idx UNIQUE (user_id, book_id, borrow_date)
);

-- Indexes for Borrowing History
CREATE INDEX idx_user_id ON borrowing_histories (user_id);
CREATE INDEX idx_book_id ON borrowing_histories (book_id);




